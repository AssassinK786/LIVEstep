#!/bin/sh

. /usr/local/GNUstep/System/Makefiles/GNUstep.sh

# This works
defaults write NSGlobalDomain GSTheme Rik

# Does this do anything?
defaults write NSGlobalDomain NSMenuInterfaceStyle NSMacintoshInterfaceStyle

# Does this do anything?
defaults write NSGlobalDomain GSBackHandlesWindowDecoration YES # https://github.com/AlessandroSangiuliano/uroswm/issues/2#issuecomment-695198746

# Do not show hidden files in GWorkspace
defaults write NSGlobalDomain GSFileBrowserHideDotFiles YES

# Fonts
defaults write NSGlobalDomain NSFont "Luxi Sans"
defaults write NSGlobalDomain NSBoldFont "Luxi Sans"
defaults write NSGlobalDomain NSUserFont "Luxi Sans"
defaults write NSGlobalDomain NSFontSize "13"

# Courtesy mounts
sudo mkdir -p /Local /System /Users /Volumes
mount | grep  /Local || sudo mount -t nullfs /usr/local/GNUstep/Local /Local
mount | grep  /System || sudo mount -t nullfs /usr/local/GNUstep/System /System
mount | grep  /Users || sudo mount -t nullfs /usr/home /Users
mount | grep  /Volumes || sudo mount -t nullfs /media /Volumes

# Enable single click for the Dock; needs patched GWorkspace from
# https://github.com/BertrandDekoninck/gworkspace
# FIXME: Does not work
defaults write GWorkspace dockclickpolicy 1

# Use Terminal.app
defaults write GWorkspace terminal_services YES

# Terminal black text on white background
defaults write Terminal BlackOnWhite YES
 
# Bring Dock to the left
defaults write GWorkspace dockposition 0

# Put applications into Dock
defaults write GWorkspace applications '{ 1 = TextEdit; 2 = Terminal; 3 = SimpleAgenda; 4 = GNUMail; 5 = Gorm; 6 = ProjectCenter; }'

# Set wallpaper color to blue
defaults write GWorkspace desktopinfo '{ backcolor = { alpha = 1; blue = "0.7"; green = "0.5"; red = "0.3"; }; "fsn_info_type" = 0; iconposition = 5; iconsize = 48; imagestyle = 0; indexes = { }; labeltxtsize = 12; usebackimage = 0;}'

# Drop shadows
compton &

# Show a global menu while a non-GS application is foremost
openapp TopBar &

openapp GWorkspace &

# Does not work properly yet, still in early development
# uroswm

# Hence using Fluxbox for now; FIXME: Find something more suitable
# As long as we use Fluxbox, at least hide its toolbar
# FIXME: Remove the need for Fluxbox
# mkdir -p ~/.fluxbox/
# cat > ~/.fluxbox/init <<\EOF
# session.screen0.toolbar.tools:  prevworkspace, workspacename, nextworkspace, clock, prevwindow, nextwindow, iconbar            
# session.screen0.toolbar.autoHide:       false
# session.screen0.toolbar.visible:        false
# EOF
# fluxbox

# TODO: Replace with something more suitable
wmaker --dont-restore --no-autolaunch --no-clip --no-dock --no-drawer --replace --static
